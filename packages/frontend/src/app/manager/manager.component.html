<div class="headLogPass">
  <div class="password-change">
    <mat-accordion class="example-headers-align">
      <mat-expansion-panel hideToggle>
        <mat-expansion-panel-header class="itemsInsideDiv">
          <mat-panel-title class="align"> Promeni lozinku </mat-panel-title>
          <mat-panel-description class="align">
            Kliknite da promenite
            <mat-icon class="key"> key </mat-icon>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <form [formGroup]="passwordForm" (ngSubmit)="changeThePassword()">
          <div>
            <mat-form-field>
              <mat-label>Stara lozinka</mat-label>
              <input matInput type="password" formControlName="oldPassword" />
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label>Nova lozinka</mat-label>
              <input matInput type="password" formControlName="newPassword" />
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label>Ponovite novu lozinku</mat-label>
              <input matInput type="password" formControlName="confirmPassword" />
            </mat-form-field>
          </div>
          <mat-action-row>
            <button mat-button color="primary" type="submit">Promeni</button>
          </mat-action-row>
          <p *ngIf="error" class="error">
            {{ error }}
          </p>
          <p *ngIf="passwordChanged" class="passwordChanged">
            {{ passwordChanged }}
          </p>
        </form>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
  <div class="logout-button">
    <button mat-raised-button color="primary" (click)="logout()">Izloguj se</button>
  </div>
</div>
<div class="menu">
  <mat-tab-group animationDuration="0ms" class="full-width-tabs">
    <mat-tab label="Lekari">
      <div class="container">
        <!-- JEDAN DOKTOR -->
        <div class="doctors-info" *ngIf="selectedDoctor; else doctorList">
          <div class="doctor-card-details">
            <ng-container *ngIf="!editingProfileDoctor">
              <div class="doctor-info">
                <p class="doctor-name">
                  {{ selectedDoctor.first_name }} {{ selectedDoctor.last_name }}
                </p>
                <p><strong>E-mail:</strong> {{ selectedDoctor.email }}</p>
                <p><strong>Korisnicko ime:</strong> {{ selectedDoctor.username }}</p>
                <img [src]="selectedDoctor.profile_picture" alt="Profilna slika" />
                <p class="doctor-specialization">
                  {{ selectedDoctor.specialization }}
                </p>
                <p>Ogranak: {{ selectedDoctor.branch }}</p>
              </div>
              <!-- PREGLEDI KOJE OMOGUCAVA LEKAR -->
              <div class="appointments">
                <table mat-table [dataSource]="selectedDoctor.appointments" class="mat-elevation-z8 demo-table">
                  <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef>Pregled</th>
                    <td mat-cell *matCellDef="let appointment">
                      {{ appointment.name }}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="duration">
                    <th mat-header-cell *matHeaderCellDef>
                      Duzina pregleda (min)
                    </th>
                    <td mat-cell *matCellDef="let appointment">
                      {{ appointment.duration }}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="price">
                    <th mat-header-cell *matHeaderCellDef>Cena (RSD)</th>
                    <td mat-cell *matCellDef="let appointment">
                      {{ appointment.price }}
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="['name', 'duration', 'price']"></tr>
                  <tr mat-row *matRowDef="
                      let appointment;
                      columns: ['name', 'duration', 'price']
                    "></tr>
                </table>
                <hr>
                <div class="buttons_book_back">
                  <button mat-stroked-button color="primary" (click)="clearSelectedDoctor()">
                    Nazad
                  </button>
                  <button mat-stroked-button color="primary" (click)="startEditingProfileDoctor()">
                    Ažuriraj Profil
                  </button>
                </div>
                <div style="margin-top: 10px; display: flex; justify-content: center;">
                  <button mat-fab color="primary" (click)="deleteUser(selectedPatient)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="editingProfileDoctor">
              <form [formGroup]="profileFormDoctor" style="width: 500px">
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Ime</mat-label>
                    <input matInput formControlName="first_name" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Prezime</mat-label>
                    <input matInput formControlName="last_name" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Adresa</mat-label>
                    <input matInput formControlName="address" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>E-mail adresa</mat-label>
                    <input matInput formControlName="email" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Korisnicko ime</mat-label>
                    <input matInput formControlName="username" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Kontakt telefon</mat-label>
                    <input matInput formControlName="phone" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Specijalizacija</mat-label>
                    <mat-select formControlName="specialization">
                      <mat-option *ngFor="let s of specializations" [value]="s.name">{{s.name}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <button class="saveCancel" mat-raised-button color="primary" (click)="saveEditedProfileDoctor()">
                  Sačuvaj
                </button>
                <button class="saveCancel" mat-raised-button color="warn" (click)="cancelEditingProfileDoctor()">
                  Otkaži
                </button>
              </form>
            </ng-container>
          </div>
        </div>

        <!-- Prikazivanje liste lekara -->
        <ng-template #doctorList>
          <div class="title-section">
            <h2>Svi lekari</h2>
          </div>
          <div class="doctors-container">
            <ng-container *ngIf="doctors.length > 0; else noDoctors">
              <div *ngFor="let doctor of doctors" class="doctor-card" (click)="selectDoctor(doctor.username)">
                <img [src]="doctor.profile_picture" alt="Profilna slika" />
                <div class="doctor-info">
                  <p>{{ doctor.first_name }} {{ doctor.last_name }}</p>
                  <p>{{ doctor.specialization }}</p>
                </div>
              </div>
            </ng-container>
          </div>
        </ng-template>
      </div>

      <ng-template #noDoctors>
        <p>Nema doktora</p>
      </ng-template>
    </mat-tab>




    <!-- PACIJENTI -->
    <mat-tab label="Pacijenti">
      <div class="container">
        <div class="doctors-info" *ngIf="selectedPatient; else patientList">
          <div class="profile-details">
            <ng-container *ngIf="!editingProfile">
              <div class="centralImg">
                <img class="profileImg" [src]="selectedPatient.profile_picture" alt="Profilna slika" />
              </div>
              <p><strong>Ime:</strong> {{ selectedPatient.first_name }}</p>
              <p><strong>Prezime:</strong> {{ selectedPatient.last_name }}</p>
              <p><strong>Adresa:</strong> {{ selectedPatient.address }}</p>
              <p><strong>E-mail adresa:</strong> {{ selectedPatient.email }}</p>
              <p><strong>Korisnicko ime:</strong> {{ selectedPatient.username }}</p>
              <p>
                <strong>Kontakt telefon:</strong> {{ selectedPatient.phone }}
              </p>
              <hr>
              <div class="buttons_book_back">
                <button mat-stroked-button color="primary" (click)="clearSelectedPatient()">
                  Nazad
                </button>

                <button mat-stroked-button color="primary" (click)="startEditingProfile()">
                  Ažuriraj Profil
                </button>
              </div>
              <div style="margin-top: 10px;">
                <button mat-fab color="primary" (click)="deleteUser(selectedPatient)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>

            </ng-container>
            <ng-container *ngIf="editingProfile">
              <form [formGroup]="profileForm">
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Ime</mat-label>
                    <input matInput formControlName="first_name" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Prezime</mat-label>
                    <input matInput formControlName="last_name" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Adresa</mat-label>
                    <input matInput formControlName="address" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>E-mail adresa</mat-label>
                    <input matInput formControlName="email" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Korisnicko ime</mat-label>
                    <input matInput formControlName="username" />
                  </mat-form-field>
                </div>
                <div class="editFields">
                  <mat-form-field>
                    <mat-label>Kontakt telefon</mat-label>
                    <input matInput formControlName="phone" />
                  </mat-form-field>
                </div>
                <button class="saveCancel" mat-raised-button color="primary" (click)="saveEditedProfile()">
                  Sačuvaj
                </button>

                <button class="saveCancel" mat-raised-button color="warn" (click)="cancelEditingProfile()">
                  Otkaži
                </button>
              </form>
            </ng-container>
          </div>
        </div>

        <!-- PACIJENTI -->

        <ng-template #patientList>
          <div class="title-section">
            <h2>Svi pacijenti</h2>
          </div>
          <div class="doctors-container">
            <ng-container *ngIf="patients.length > 0; else noPaticent">
              <div *ngFor="let patient of patients" class="doctor-card" (click)="selectPatient(patient.username)">
                <img [src]="patient.profile_picture" alt="Profilna slika" />
                <div class="doctor-info">
                  <p>{{ patient.first_name }} {{ patient.last_name }}</p>
                </div>
              </div>
            </ng-container>
          </div>
        </ng-template>
      </div>

      <ng-template #noPaticent>
        <p>Nema pacijenata</p>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</div>
